# **Booking FastAPI**

Booking_fastapi — это высокоэффективное API для управления бронированиями в гостиницах и аренде объектов. Включает регистрацию и управление пользователями, создание и управление бронированиями, а также мониторинг состояния системы с помощью современных инструментов. Этот проект построен с использованием **FastAPI** для создания быстрых и асинхронных RESTful API, **PostgreSQL** для хранения данных, **Redis** для кэширования, и **Celery** для обработки фоновых задач.

Также проект интегрирован с **Prometheus** и **Grafana** для мониторинга и визуализации метрик системы, что позволяет отслеживать её состояние и производительность в реальном времени.

## **Основные возможности**

- **Управление пользователями**: Регистрация, аутентификация и авторизация пользователей с поддержкой JWT-токенов. Восстановление паролей и управление сессиями.
- **Бронирование отелей**: Пользователи могут создавать и управлять своими бронированиями на основе доступных номеров в отелях.
- **Асинхронная обработка задач**: Использование **Celery** для выполнения длительных операций в фоновом режиме, таких как обработка подтверждений бронирования, отправка уведомлений или взаимодействие с внешними API.
- **Мониторинг системы**: Интеграция с **Prometheus** для сбора метрик, а также с **Grafana** для их визуализации. Эти инструменты позволяют в реальном времени отслеживать состояние приложения и производительность.
- **Миграции базы данных**: **Alembic** для управления миграциями схемы базы данных, обеспечивая простоту обновлений и совместимость с новыми версиями.
- **Документация API**: Полная интерактивная документация с использованием Swagger UI, доступная через веб-интерфейс для тестирования и ознакомления с API.

## **В чем преимущества этого проекта?**

### **1. Высокая производительность с FastAPI**

FastAPI — один из самых быстрых фреймворков для создания API. Он идеально подходит для приложений с высокой нагрузкой, поддерживает асинхронные операции из коробки и легко интегрируется с различными компонентами системы.

### **2. Масштабируемость и гибкость**

Проект использует **Docker** для контейнеризации всех сервисов. Это позволяет легко развертывать систему как в локальной среде, так и в продакшн-окружении, а также масштабировать её компоненты по мере роста нагрузки.

### **3. Инструменты для мониторинга и анализа**

**Prometheus** и **Grafana** обеспечивают мощную систему мониторинга, которая позволяет отслеживать ключевые метрики, такие как количество запросов, время отклика и нагрузку на сервер. Это помогает быстро выявлять и устранять потенциальные проблемы.

### **4. Современная архитектура и тестирование**

Проект использует лучшие практики разработки, включая тестирование с использованием **pytest** и управление зависимостями с помощью **Docker** и **Alembic**. Это делает код легко расширяемым и поддерживаемым.

### **5. Поддержка асинхронных задач**

С помощью **Celery** проект поддерживает асинхронное выполнение задач, что улучшает производительность и уменьшает нагрузку на основной процесс. Задачи, такие как отправка уведомлений или обработка длительных операций, выполняются в фоновом режиме.

### **6. Простота развертывания и использования**

Проект использует **Docker Compose**, что упрощает развертывание всей системы. Один клик — и вся инфраструктура, включая базу данных, Redis, Celery и мониторинг, запущены в контейнерах.

## **Как работает проект?**

### **1. Пользовательский процесс**

- **Регистрация и авторизация**: Пользователь может зарегистрироваться, войти с помощью JWT-токенов и управлять своей учетной записью.
- **Бронирование**: Пользователь выбирает отель и дату для бронирования, а затем оформляет заказ. После этого система подтверждает запрос и отправляет уведомление.
- **Администрирование**: Администраторы могут управлять отелями, номерами и бронированиями через API.

### **2. Механизм работы с данными**

- **PostgreSQL**: Основная база данных для хранения информации о пользователях, отелях и бронированиях.
- **Redis**: Используется для кэширования данных, ускоряя обработку запросов и улучшая производительность.
- **Celery**: Асинхронная обработка задач в фоновом режиме, таких как отправка уведомлений или взаимодействие с внешними сервисами.

### **3. Миграции и обновления**

Для управления изменениями в базе данных используется **Alembic**. При изменении модели данных необходимо выполнить миграции с помощью Alembic, чтобы база данных оставалась актуальной.

### **4. Мониторинг**

- **Prometheus** собирает метрики с различных сервисов, таких как база данных, Redis, Celery, и сам FastAPI сервер.
- **Grafana** визуализирует эти метрики в реальном времени, предоставляя удобный интерфейс для мониторинга состояния системы.

## **Как запустить проект?**

### **1. Локальный запуск с Docker**

Для того чтобы запустить проект локально, выполните следующие шаги:

1. Убедитесь, что у вас установлены **Docker** и **Docker Compose**.
2. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Raynece/booking_fastapi.git
   cd booking_fastapi
   ```

3. Скопируйте файл `.env-non-dev` в `.env` и настройте необходимые переменные окружения (например, параметры подключения к базе данных).
4. Запустите проект с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

Это создаст контейнеры для всех компонентов системы: базы данных PostgreSQL, Redis, Celery, FastAPI, и мониторинга с Prometheus и Grafana.

### **2. Запуск FastAPI без Docker**

Если вы хотите запустить проект без использования Docker, следуйте этим шагам:

1. Убедитесь, что у вас установлены все необходимые зависимости. Для этого создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows используйте venv\Scripts\activate
   ```

2. Установите зависимости из `requirements.txt`:
   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл `.env` в корне проекта и настройте переменные окружения. Пример содержимого файла `.env-example`
 

4. Запустите миграции базы данных с помощью Alembic:
   ```bash
   alembic upgrade head
   ```

5. Запустите сервер FastAPI с использованием `uvicorn`:
   ```bash
   uvicorn app.main:app --reload
   ```

Теперь проект будет доступен по адресу `http://127.0.0.1:8000`.

### **3. Остановка проекта**

Для остановки всех контейнеров используйте команду:
```bash
docker-compose down
```

## **Мониторинг и визуализация**

- **Prometheus** будет доступен на порту `9090`.
- **Grafana** будет доступен на порту `3000`. Стандартные логины и пароли: `admin` / `admin`. 
  После первого входа вас попросят изменить пароль.

## **Тестирование**

Тесты могут быть выполнены с помощью **pytest**. Для запуска тестов используйте команду в корне папки с тестами:

```bash
pytest
```

### **2. Запуск FastAPI без Docker**

Если вы хотите запустить проект без использования Docker, следуйте этим шагам:

1. Убедитесь, что у вас установлены все необходимые зависимости. Для этого создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows используйте venv\Scripts\activate
   ```

2. Установите зависимости из `requirements.txt`:
   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл `.env` в корне проекта и настройте переменные окружения. Пример содержимого файла `.env`:
   ```
   DATABASE_URL=postgresql+asyncpg://postgres:password@localhost:5432/your_database
   REDIS_URL=redis://localhost:6379/0
   SECRET_KEY=your-secret-key
   ```

4. Запустите миграции базы данных с помощью Alembic:
   ```bash
   alembic upgrade head
   ```

5. Запустите сервер FastAPI с использованием `uvicorn`:
   ```bash
   uvicorn app.main:app --reload
   ```

Теперь проект будет доступен по адресу `http://127.0.0.1:8000`.
